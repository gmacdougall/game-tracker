<%= show_for @player do |s| %>
  <%= s.attribute :first_name %>
  <%= s.attribute :last_name %>
<% end %>

<h3>Games Played</h3>
<table class='table table-bordered table-condensed data-table' data-sort-column='1' data-sort-direction='desc'>
  <thead>
    <tr>
      <th>Player</th>
      <th>P</th>
      <th>W</th>
      <th>L</th>
      <th>X</th>
      <th>W%</th>
    </tr>
  </thead>
  <tbody>
    <% @games.each do |g| %>
      <% set = InstanceSet.new g.instances %>
      <% if set.plays(@player) > 0 %>
        <tr>
          <td><%= link_to g.name, g %></td>
          <% stats = InstanceSetStatistics.new set, @player %>
          <td><%= set.plays(@player) %></td>
          <td><%= set.wins(@player) %></td>
          <td><%= set.losses(@player) %></td>
          <td><%= set.excluded(@player) %></td>
          <td><%= number_with_precision stats.winning_percentage, precision: 3 %></td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
<h3>Recently Played</h3>
<table class='table table-bordered table-condensed data-table' data-sort-direction='desc'>
  <thead>
    <tr>
      <th>Play Date</th>
      <th>Game Name</th>
      <th>Result</th>
    </tr>
  </thead>
  <tbody>
    <% @instances.each do |i| %>
      <% if i.played_by?(@player) %>
        <tr>
          <td><%= link_to i.play_date, i %></td>
          <td><%= link_to i.game.name, i.game %></td>
          <td><%= i.result @player %></td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>

<%= link_to 'Edit', edit_player_path(@player), class: 'btn btn-warning' if can? :edit, @player %>
<%= link_to 'Back', players_path, class: 'btn' if can? :index, :player %>
